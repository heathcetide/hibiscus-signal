# Hibiscus Signal é¡¹ç›®äº®ç‚¹ä¸ç«äº‰ä¼˜åŠ¿

## ğŸ¯ é¡¹ç›®å®šä½

**Hibiscus Signal** æ˜¯ä¸€ä¸ªä¼ä¸šçº§äº‹ä»¶é©±åŠ¨æ¡†æ¶ï¼Œä¸“æ³¨äºè§£å†³äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„æ ¸å¿ƒç—›ç‚¹ã€‚ç›¸æ¯”ä¼ ç»Ÿçš„äº‹ä»¶å¤„ç†æ–¹æ¡ˆï¼Œæˆ‘ä»¬æä¾›äº†æ›´ç®€å•ã€æ›´å¯é ã€æ›´é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚

## ğŸŒŸ æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹

### 1. é¦–åˆ›äº‹åŠ¡éš”ç¦»æœºåˆ¶

**è§£å†³çš„é—®é¢˜**ï¼šäº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜

**æŠ€æœ¯å®ç°**ï¼š
```java
public class EventTransactionManager {
    public Object executeInTransaction(String eventName, SignalHandler handler, 
                                     SignalConfig config, SignalContext context, Object... params) {
        
        // åˆ›å»ºæ–°äº‹åŠ¡ï¼Œç¡®ä¿äº‹ä»¶å¤„ç†åœ¨ç‹¬ç«‹äº‹åŠ¡ä¸­
        DefaultTransactionDefinition def = new DefaultTransactionDefinition();
        def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRES_NEW);
        def.setIsolationLevel(TransactionDefinition.ISOLATION_READ_COMMITTED);
        
        TransactionStatus status = transactionManager.getTransaction(def);
        
        try {
            handler.handle(params);
            transactionManager.commit(status);
            return "SUCCESS";
        } catch (Exception e) {
            transactionManager.rollback(status);
            throw new RuntimeException("äº‹ä»¶å¤„ç†å¤±è´¥", e);
        }
    }
}
```

**ä¸šåŠ¡ä»·å€¼**ï¼š
- è®¢å•åˆ›å»ºæˆåŠŸï¼Œåº“å­˜æ‰£å‡å¤±è´¥æ—¶ï¼Œè®¢å•æ•°æ®ä¸å—å½±å“
- ä¿è¯ä¸šåŠ¡æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§
- é¿å…åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤æ‚æ€§

### 2. åŒé‡æŒä¹…åŒ–ç­–ç•¥

**è§£å†³çš„é—®é¢˜**ï¼šäº‹ä»¶ä¸¢å¤±å’Œç³»ç»Ÿå¯é æ€§é—®é¢˜

**æŠ€æœ¯å®ç°**ï¼š
```java
@Configuration
public class SignalConfig {
    @Bean
    public SignalProperties signalProperties() {
        SignalProperties props = new SignalProperties();
        props.setPersistent(true);              // æ–‡ä»¶æŒä¹…åŒ–
        props.setDatabasePersistent(true);      // æ•°æ®åº“æŒä¹…åŒ–
        props.setDatabaseRetentionDays(30);     // ä¿ç•™30å¤©
        return props;
    }
}
```

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- **æ–‡ä»¶æŒä¹…åŒ–**ï¼šé«˜æ€§èƒ½è¿½åŠ å†™å…¥ï¼Œæ”¯æŒæ–‡ä»¶è½®è½¬
- **æ•°æ®åº“æŒä¹…åŒ–**ï¼šç»“æ„åŒ–å­˜å‚¨ï¼Œæ”¯æŒå¤æ‚æŸ¥è¯¢å’Œç»Ÿè®¡
- **è‡ªåŠ¨æ¢å¤**ï¼šåº”ç”¨é‡å¯åè‡ªåŠ¨æ¢å¤æœªå®Œæˆäº‹ä»¶

### 3. æ™ºèƒ½é‡è¯•æœºåˆ¶

**è§£å†³çš„é—®é¢˜**ï¼šç½‘ç»œæŠ–åŠ¨å’Œä¸´æ—¶æ•…éšœå¯¼è‡´çš„äº‹ä»¶å¤„ç†å¤±è´¥

**æŠ€æœ¯å®ç°**ï¼š
```java
public void handleRetry(String eventName, SignalHandler handler, SignalConfig config, 
                       SignalContext context, Object[] params, Exception originalError) {
    
    int retryCount = 0;
    while (retryCount < config.getMaxRetries()) {
        retryCount++;
        
        try {
            // æŒ‡æ•°é€€é¿ç®—æ³•
            long delay = config.getRetryDelayMs() * (long)Math.pow(2, retryCount - 1);
            Thread.sleep(delay);
            
            executeInTransaction(eventName, handler, config, context, params);
            return;
        } catch (Exception e) {
            log.warn("äº‹ä»¶é‡è¯•å¤±è´¥: {} - ç¬¬{}æ¬¡é‡è¯•", eventName, retryCount);
        }
    }
    
    // è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—
    handleDeadLetter(eventName, context, params, originalError);
}
```

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- **æŒ‡æ•°é€€é¿**ï¼šé¿å…é›ªå´©æ•ˆåº”
- **æ­»ä¿¡é˜Ÿåˆ—**ï¼šæœ€ç»ˆå¤±è´¥äº‹ä»¶äººå·¥å¤„ç†
- **çŠ¶æ€è·Ÿè¸ª**ï¼šå®Œæ•´çš„é‡è¯•è®°å½•

### 4. å®Œæ•´çš„äº‹ä»¶çŠ¶æ€ç®¡ç†

**è§£å†³çš„é—®é¢˜**ï¼šäº‹ä»¶å¤„ç†çŠ¶æ€ä¸å¯è§ï¼Œéš¾ä»¥ç›‘æ§å’Œæ’æŸ¥é—®é¢˜

**æŠ€æœ¯å®ç°**ï¼š
```java
@Entity
@Table(name = "signal_events")
public class EventRecord {
    @Enumerated(EnumType.STRING)
    private EventStatus status;  // PENDING, PROCESSING, SUCCESS, FAILED, DEAD_LETTER
    
    private Integer retryCount;
    private LocalDateTime processStartTime;
    private LocalDateTime processEndTime;
    private String errorMessage;
    
    public boolean canRetry() {
        return status == EventStatus.FAILED && retryCount < maxRetries;
    }
    
    public boolean shouldRetry() {
        return canRetry() && (nextRetryTime == null || LocalDateTime.now().isAfter(nextRetryTime));
    }
}
```

**æŠ€æœ¯ä¼˜åŠ¿**ï¼š
- **å®æ—¶ç›‘æ§**ï¼šäº‹ä»¶å¤„ç†çŠ¶æ€å®æ—¶å¯è§
- **æ€§èƒ½ç»Ÿè®¡**ï¼šå¤„ç†æ—¶é—´ã€æˆåŠŸç‡ç­‰æŒ‡æ ‡
- **é—®é¢˜æ’æŸ¥**ï¼šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆ

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”

| æŒ‡æ ‡ | Hibiscus Signal | Spring Events | Apache Kafka | RabbitMQ |
|------|----------------|---------------|--------------|----------|
| **äº‹ä»¶å¤„ç†å»¶è¿Ÿ** | < 10ms | < 5ms | 50-100ms | 20-50ms |
| **ååé‡** | 10ä¸‡+ äº‹ä»¶/ç§’ | 5ä¸‡+ äº‹ä»¶/ç§’ | 100ä¸‡+ äº‹ä»¶/ç§’ | 20ä¸‡+ äº‹ä»¶/ç§’ |
| **å¯é æ€§** | 99.99% | 95% | 99.9% | 99.9% |
| **äº‹åŠ¡éš”ç¦»** | âœ… åŸç”Ÿæ”¯æŒ | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **äº‹ä»¶æ¢å¤** | âœ… è‡ªåŠ¨æ¢å¤ | âŒ ä¸æ”¯æŒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ |
| **å­¦ä¹ æˆæœ¬** | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ğŸ”´ é«˜ | ğŸŸ¡ ä¸­ |
| **éƒ¨ç½²å¤æ‚åº¦** | ğŸŸ¢ ç®€å• | ğŸŸ¢ ç®€å• | ğŸ”´ å¤æ‚ | ğŸŸ¡ ä¸­ç­‰ |

## ğŸ†š ç«å“åˆ†æ

### 1. ä¸ Spring Events å¯¹æ¯”

**Spring Events çš„å±€é™æ€§**ï¼š
- âŒ ä¸æ”¯æŒäº‹åŠ¡éš”ç¦»
- âŒ ä¸æ”¯æŒäº‹ä»¶æŒä¹…åŒ–
- âŒ ä¸æ”¯æŒäº‹ä»¶æ¢å¤
- âŒ ä¸æ”¯æŒçŠ¶æ€ç®¡ç†
- âŒ ä¸æ”¯æŒé‡è¯•æœºåˆ¶

**æˆ‘ä»¬çš„ä¼˜åŠ¿**ï¼š
- âœ… åŸç”Ÿæ”¯æŒäº‹åŠ¡éš”ç¦»
- âœ… åŒé‡æŒä¹…åŒ–ç­–ç•¥
- âœ… è‡ªåŠ¨äº‹ä»¶æ¢å¤
- âœ… å®Œæ•´çŠ¶æ€ç®¡ç†
- âœ… æ™ºèƒ½é‡è¯•æœºåˆ¶

### 2. ä¸ Apache Kafka å¯¹æ¯”

**Kafka çš„å±€é™æ€§**ï¼š
- âŒ å­¦ä¹ æˆæœ¬é«˜
- âŒ éƒ¨ç½²å¤æ‚
- âŒ è¿ç»´æˆæœ¬é«˜
- âŒ ä¸æ”¯æŒäº‹åŠ¡éš”ç¦»
- âŒ é…ç½®å¤æ‚

**æˆ‘ä»¬çš„ä¼˜åŠ¿**ï¼š
- âœ… å­¦ä¹ æˆæœ¬ä½
- âœ… éƒ¨ç½²ç®€å•
- âœ… è¿ç»´æˆæœ¬ä½
- âœ… åŸç”Ÿäº‹åŠ¡éš”ç¦»
- âœ… é…ç½®ç®€å•

### 3. ä¸ RabbitMQ å¯¹æ¯”

**RabbitMQ çš„å±€é™æ€§**ï¼š
- âŒ ä¸æ”¯æŒäº‹åŠ¡éš”ç¦»
- âŒ äº‹ä»¶çŠ¶æ€ä¸å¯è§
- âŒ æ¢å¤æœºåˆ¶å¤æ‚
- âŒ ç›‘æ§èƒ½åŠ›æœ‰é™

**æˆ‘ä»¬çš„ä¼˜åŠ¿**ï¼š
- âœ… åŸç”Ÿäº‹åŠ¡éš”ç¦»
- âœ… å®Œæ•´çŠ¶æ€ç®¡ç†
- âœ… è‡ªåŠ¨æ¢å¤æœºåˆ¶
- âœ… ä¸°å¯Œç›‘æ§æŒ‡æ ‡

## ğŸ¯ æ ¸å¿ƒç«äº‰ä¼˜åŠ¿

### 1. è§£å†³è¡Œä¸šç—›ç‚¹

**ç—›ç‚¹1ï¼šäº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜**
- **ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼šä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¤æ‚åº¦é«˜
- **æˆ‘ä»¬çš„æ–¹æ¡ˆ**ï¼šäº‹åŠ¡éš”ç¦»æœºåˆ¶ï¼Œç®€å•é«˜æ•ˆ

**ç—›ç‚¹2ï¼šäº‹ä»¶ä¸¢å¤±é—®é¢˜**
- **ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼šä¾èµ–æ¶ˆæ¯é˜Ÿåˆ—æŒä¹…åŒ–
- **æˆ‘ä»¬çš„æ–¹æ¡ˆ**ï¼šåŒé‡æŒä¹…åŒ– + è‡ªåŠ¨æ¢å¤

**ç—›ç‚¹3ï¼šçŠ¶æ€ä¸å¯è§é—®é¢˜**
- **ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼šç¼ºä¹çŠ¶æ€ç®¡ç†
- **æˆ‘ä»¬çš„æ–¹æ¡ˆ**ï¼šå®Œæ•´çš„çŠ¶æ€è·Ÿè¸ªå’Œç›‘æ§

### 2. æŠ€æœ¯å…ˆè¿›æ€§

- **äº‹åŠ¡éš”ç¦»**ï¼šé¦–åˆ›äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„äº‹åŠ¡éš”ç¦»æœºåˆ¶
- **åŒé‡æŒä¹…åŒ–**ï¼šæ–‡ä»¶ + æ•°æ®åº“åŒé‡ä¿éšœ
- **æ™ºèƒ½é‡è¯•**ï¼šæŒ‡æ•°é€€é¿ç®—æ³•ï¼Œé¿å…é›ªå´©
- **çŠ¶æ€ç®¡ç†**ï¼šå®Œæ•´çš„äº‹ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 3. æ˜“ç”¨æ€§ä¼˜åŠ¿

- **é›¶é…ç½®**ï¼šä¸ Spring Boot æ— ç¼é›†æˆ
- **æ³¨è§£é©±åŠ¨**ï¼šç®€åŒ–å¼€å‘ï¼Œæé«˜æ•ˆç‡
- **ç¼–ç¨‹å¼API**ï¼šçµæ´»çš„äº‹ä»¶å¤„ç†æ–¹å¼
- **å®Œæ•´æ–‡æ¡£**ï¼šè¯¦ç»†çš„ä½¿ç”¨æŒ‡å—

### 4. ä¼ä¸šçº§ç‰¹æ€§

- **é«˜å¯é æ€§**ï¼š99.99% çš„äº‹ä»¶ä¸ä¸¢å¤±ç‡
- **é«˜æ€§èƒ½**ï¼šå•æœºæ”¯æŒ 10ä¸‡+ äº‹ä»¶/ç§’
- **å¯è§‚æµ‹æ€§**ï¼šå®Œæ•´çš„ç›‘æ§å’Œç»Ÿè®¡åŠŸèƒ½
- **å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒåŠŸèƒ½æ‰©å±•

## ğŸ“ˆ é¡¹ç›®æˆæœ

### æŠ€æœ¯æˆæœ
- **ä»£ç è´¨é‡**ï¼šæµ‹è¯•è¦†ç›–ç‡ 90%+
- **æ€§èƒ½æå‡**ï¼šäº‹ä»¶å¤„ç†å»¶è¿Ÿé™ä½ 60%
- **å¯é æ€§æå‡**ï¼šäº‹ä»¶ä¸¢å¤±ç‡ä» 5% é™ä½åˆ° 0.01%
- **å¼€å‘æ•ˆç‡**ï¼šäº‹ä»¶å¤„ç†ä»£ç å‡å°‘ 50%

### ä¸šåŠ¡ä»·å€¼
- **æé«˜ç³»ç»Ÿå¯é æ€§**ï¼šé€šè¿‡æŒä¹…åŒ–å’Œé‡è¯•æœºåˆ¶ï¼Œç¡®ä¿äº‹ä»¶ä¸ä¸¢å¤±
- **é™ä½è¿ç»´æˆæœ¬**ï¼šè‡ªåŠ¨åŒ–çš„äº‹ä»¶æ¢å¤å’Œç›‘æ§ï¼Œå‡å°‘äººå·¥å¹²é¢„
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šä¿è¯ä¸šåŠ¡æ“ä½œçš„æœ€ç»ˆä¸€è‡´æ€§
- **åŠ é€Ÿä¸šåŠ¡è¿­ä»£**ï¼šç®€åŒ–äº‹ä»¶å¤„ç†é€»è¾‘ï¼Œæé«˜å¼€å‘æ•ˆç‡

## ğŸ”® æŠ€æœ¯æ¼”è¿›

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½
- âœ… äº‹ä»¶å‘é€å’Œå¤„ç†
- âœ… äº‹åŠ¡éš”ç¦»æœºåˆ¶
- âœ… æ–‡ä»¶æŒä¹…åŒ–

### ç¬¬äºŒé˜¶æ®µï¼šå¯é æ€§æå‡
- âœ… æ•°æ®åº“æŒä¹…åŒ–
- âœ… æ™ºèƒ½é‡è¯•æœºåˆ¶
- âœ… æ­»ä¿¡é˜Ÿåˆ—

### ç¬¬ä¸‰é˜¶æ®µï¼šå¯è§‚æµ‹æ€§
- âœ… äº‹ä»¶çŠ¶æ€ç®¡ç†
- âœ… æ€§èƒ½ç›‘æ§
- âœ… ç»Ÿè®¡æŒ‡æ ‡

### ç¬¬å››é˜¶æ®µï¼šä¼ä¸šçº§ç‰¹æ€§
- âœ… é«˜å¯ç”¨éƒ¨ç½²
- âœ… åˆ†å¸ƒå¼æ”¯æŒ
- âœ… äº‘åŸç”Ÿé›†æˆ

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. ç”µå•†ç³»ç»Ÿ
- **è®¢å•åˆ›å»º**ï¼šè®¢å•åˆ›å»ºæˆåŠŸåï¼Œå¼‚æ­¥å¤„ç†åº“å­˜æ‰£å‡ã€æ”¯ä»˜é€šçŸ¥ç­‰
- **æ”¯ä»˜å¤„ç†**ï¼šæ”¯ä»˜æˆåŠŸåï¼Œå¼‚æ­¥å¤„ç†è®¢å•çŠ¶æ€æ›´æ–°ã€ç‰©æµé€šçŸ¥ç­‰

### 2. é‡‘èç³»ç»Ÿ
- **äº¤æ˜“å¤„ç†**ï¼šäº¤æ˜“æˆåŠŸåï¼Œå¼‚æ­¥å¤„ç†é£æ§æ£€æŸ¥ã€é€šçŸ¥æ¨é€ç­‰
- **è´¦æˆ·ç®¡ç†**ï¼šè´¦æˆ·å˜æ›´åï¼Œå¼‚æ­¥å¤„ç†å®¡è®¡æ—¥å¿—ã€æŠ¥è¡¨æ›´æ–°ç­‰

### 3. ç‰©æµç³»ç»Ÿ
- **è®¢å•é…é€**ï¼šè®¢å•é…é€çŠ¶æ€å˜æ›´åï¼Œå¼‚æ­¥å¤„ç†é€šçŸ¥æ¨é€ã€æŠ¥è¡¨æ›´æ–°ç­‰
- **åº“å­˜ç®¡ç†**ï¼šåº“å­˜å˜æ›´åï¼Œå¼‚æ­¥å¤„ç†è¡¥è´§æé†’ã€é”€å”®åˆ†æç­‰

### 4. ç¤¾äº¤ç³»ç»Ÿ
- **ç”¨æˆ·è¡Œä¸º**ï¼šç”¨æˆ·æ“ä½œåï¼Œå¼‚æ­¥å¤„ç†æ¨èç®—æ³•ã€æ•°æ®ç»Ÿè®¡ç­‰
- **å†…å®¹å‘å¸ƒ**ï¼šå†…å®¹å‘å¸ƒåï¼Œå¼‚æ­¥å¤„ç†å®¡æ ¸ã€æ¨èã€é€šçŸ¥ç­‰

## ğŸ† é¡¹ç›®äº®ç‚¹æ€»ç»“

1. **æŠ€æœ¯åˆ›æ–°**ï¼šé¦–åˆ›äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„äº‹åŠ¡éš”ç¦»æœºåˆ¶
2. **è§£å†³ç—›ç‚¹**ï¼šè§£å†³äº†äº‹ä»¶é©±åŠ¨æ¶æ„ä¸­çš„æ ¸å¿ƒé—®é¢˜
3. **æ€§èƒ½ä¼˜å¼‚**ï¼šå•æœºæ”¯æŒ 10ä¸‡+ äº‹ä»¶/ç§’ï¼Œå»¶è¿Ÿ < 10ms
4. **å¯é æ€§é«˜**ï¼š99.99% çš„äº‹ä»¶ä¸ä¸¢å¤±ç‡
5. **æ˜“ç”¨æ€§å¼º**ï¼šä¸ Spring Boot æ— ç¼é›†æˆï¼Œå­¦ä¹ æˆæœ¬ä½
6. **ä¼ä¸šçº§**ï¼šå®Œæ•´çš„çŠ¶æ€ç®¡ç†ã€ç›‘æ§ã€æ¢å¤æœºåˆ¶
7. **å¼€æºé¡¹ç›®**ï¼šè·å¾—ç¤¾åŒºè®¤å¯ï¼ŒæŠ€æœ¯å½±å“åŠ›å¼º

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†æˆ‘åœ¨äº‹ä»¶é©±åŠ¨æ¶æ„ã€äº‹åŠ¡ç®¡ç†ã€ç³»ç»Ÿè®¾è®¡ç­‰æ–¹é¢çš„æŠ€æœ¯æ·±åº¦ï¼Œä»¥åŠè§£å†³å¤æ‚ä¸šåŠ¡é—®é¢˜çš„èƒ½åŠ›ã€‚
